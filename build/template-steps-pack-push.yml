parameters:
- name: packageName
  type: string
- name: nugetKey
  type: string

steps:
- task: DotNetCoreCLI@2
  displayName: 'dotnet pack $(buildConfiguration) for $(packageName)'
  inputs:
    command: pack
    packagesToPack: '**/$(packageName).csproj'
    nobuild: true
    versioningScheme: byBuildNumber
- script: dotnet nuget push $(Build.ArtifactStagingDirectory)/$(packageName).$(Build.BuildNumber).nupkg -k $(nugetKey) -s https://api.nuget.org/v3/index.json
  displayName: 'dotnet nuget push for $(packageName)'