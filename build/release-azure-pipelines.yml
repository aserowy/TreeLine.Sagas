name: $(majorMinorVersion).$(patchVersion)

trigger:
- release/*

pool:
  vmImage: 'windows-latest'

variables:
  buildConfiguration: 'Release'
  projectName: 'TreeLine.Sagas.DependencyInjection'
  majorMinorVersion: 1.0
  patchVersion: $[counter(variables['majorMinorVersion'], 0)]

steps:
- template: template-steps-build-test.yml
  parameters:
    buildConfiguration: '$(buildConfiguration)'
- task: DotNetCoreCLI@2
  displayName: 'dotnet pack $(buildConfiguration)'
  inputs:
    command: pack
    packagesToPack: '**/$(projectName).csproj'
    nobuild: true
    versioningScheme: byBuildNumber
- task: DotNetCoreCLI@2
  inputs:
    command: 'push'
    searchPatternPush: ''
    nugetFeedType: 'external'
- ${{ each package in $(Build.ArtifactStagingDirectory)/*.nupkg}}
  - script: dotnet nuget push $(package) -k $(nugetKey) -s https://api.nuget.org/v3/index.json
    displayName: 'dotnet nuget push'